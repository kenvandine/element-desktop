#!/bin/bash

connect_text="Element Desktop requires access to the password-manager-service interface

To connect the interface, in a terminal run:

<tt><b>sudo snap connect element-desktop:password-manager-service</b></tt>"
if ! snapctl is-connected password-manager-service; then
  echo "password-manager-service not connected, please connect with:"
  echo "sudo snap connect element-desktop:password-manager-service"
  zenity --title "Element Desktop: Connect to Password Manager Service" --info --text "$connect_text" --width 600
  exit
fi

WAYLAND_OPTS=""

if [ -n "$WAYLAND_DISPLAY" ] && [ -z "$DISABLE_WAYLAND" ]; then
  WAYLAND_OPTS="--enable-features=WaylandWindowDecorations,WebRTCPipeWireCapturer,UseOzonePlatform --ozone-platform-hint=auto"
fi

# Override NSS to fix issues with authd logins
export LD_PRELOAD=$SNAP/nss_patch.so

exec "$SNAP/opt/Element/element-desktop" --no-sandbox --disable-seccomp-filter-sandbox $WAYLAND_OPTS "$@"
